import{r as s,a as F,w as O,f as r,g as p,i as e,z as u,A as v,F as V,y as j,v as L,C as S,l as B,B as k,D as I,e as E,j as U,E as C,x as N}from"./index-eb4185d7.js";import{M as G}from"./modal-f2b0cdf5.js";import{_ as J}from"./DelModal-edb1a33e.js";import{_ as T}from"./Pagination-a53cc431.js";import{u as z}from"./filter-2e5f3b44.js";import"./component-functions-80165422.js";const q={class:"modal-dialog modal-xl",role:"document"},H={class:"modal-content border-0"},K=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"新增產品")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Q={class:"modal-body"},R={class:"row"},W={class:"col-sm-4"},X={class:"mb-3"},Y=e("label",{for:"image",class:"form-label"},"輸入圖片網址",-1),Z={class:"mb-3"},ee=e("label",{for:"customFile",class:"form-label"},[B("或 上傳圖片 "),e("i",{class:"fas fa-spinner fa-spin"})],-1),te=["src"],le={key:0,class:"mt-5"},oe=["onUpdate:modelValue"],se=["onClick"],ae={key:0},ne={class:"col-sm-8"},ie={class:"mb-3"},de=e("label",{for:"title",class:"form-label"},"標題",-1),ce={class:"row gx-2"},ue={class:"mb-3 col-md-6"},re=e("label",{for:"category",class:"form-label"},"分類",-1),pe={class:"mb-3 col-md-6"},me=e("label",{for:"price",class:"form-label"},"單位",-1),ve={class:"row gx-2"},_e={class:"mb-3 col-md-6"},he=e("label",{for:"origin_price",class:"form-label"},"原價",-1),fe={class:"mb-3 col-md-6"},ge=e("label",{for:"price",class:"form-label"},"售價",-1),be=e("hr",null,null,-1),ye={class:"mb-3"},xe=e("label",{for:"description",class:"form-label"},"產品描述",-1),$e={class:"mb-3"},ke=e("label",{for:"content",class:"form-label"},"說明內容",-1),we={class:"mb-3"},Me={class:"form-check"},Ue=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),Ce={class:"modal-footer"},Ve=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消",-1),Pe={__name:"ProductModal",props:{product:{type:Object,default:()=>({})}},setup(P,{expose:w}){const y=P,x=s({}),h=s({});F(()=>{h.value=new G(x.value)});const m=()=>{h.value.show()},f=()=>{h.value.hide()},t=s({});O(()=>{y.product},()=>{t.value=JSON.parse(JSON.stringify(y.product))},{deep:!0}),w({showModal:m,hideModal:f,tempProduct:t});const _=s();function M(){const g=s(new FormData);g.value.append("file-to-upload",_.value.files[0]);const l="https://vue3-course-api.hexschool.io/api/cookiemidwang-api/admin/upload";k.post(l,g.value).then(o=>{o.data.success&&(t.value.imageUrl=o.data.imageUrl)})}return(g,l)=>(r(),p("div",{class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"refOpenModal",ref:x},[e("div",q,[e("div",H,[K,e("div",Q,[e("div",R,[e("div",W,[e("div",X,[Y,u(e("input",{type:"text",class:"form-control",id:"image","onUpdate:modelValue":l[0]||(l[0]=o=>t.value.imageUrl=o),placeholder:"請輸入圖片連結"},null,512),[[v,t.value.imageUrl]])]),e("div",Z,[ee,e("input",{type:"file",id:"customFile",class:"form-control",ref_key:"fileInput",ref:_,onChange:M},null,544)]),e("img",{class:"img-fluid",src:t.value.imageUrl,alt:""},null,8,te),t.value.images?(r(),p("div",le,[(r(!0),p(V,null,j(t.value.images,(o,b)=>(r(),p("div",{class:"mb-3 input-group",key:b},[u(e("input",{type:"url",class:"form-control form-control","onUpdate:modelValue":i=>t.value.images[b]=i,placeholder:"請輸入連結"},null,8,oe),[[v,t.value.images[b]]]),e("button",{type:"button",class:"btn btn-outline-danger",onClick:i=>t.value.images.splice(b,1)}," 移除 ",8,se)]))),128)),t.value.images[t.value.images.length-1]||!t.value.images.length?(r(),p("div",ae,[e("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:l[1]||(l[1]=o=>t.value.images.push(""))}," 新增圖片 ")])):L("",!0)])):L("",!0)]),e("div",ne,[e("div",ie,[de,u(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":l[2]||(l[2]=o=>t.value.title=o),placeholder:"請輸入標題"},null,512),[[v,t.value.title]])]),e("div",ce,[e("div",ue,[re,u(e("input",{type:"text",class:"form-control",id:"category","onUpdate:modelValue":l[3]||(l[3]=o=>t.value.category=o),placeholder:"請輸入分類"},null,512),[[v,t.value.category]])]),e("div",pe,[me,u(e("input",{type:"text",class:"form-control",id:"unit","onUpdate:modelValue":l[4]||(l[4]=o=>t.value.unit=o),placeholder:"請輸入單位"},null,512),[[v,t.value.unit]])])]),e("div",ve,[e("div",_e,[he,u(e("input",{type:"number",class:"form-control",id:"origin_price","onUpdate:modelValue":l[5]||(l[5]=o=>t.value.origin_price=o),placeholder:"請輸入原價"},null,512),[[v,t.value.origin_price,void 0,{number:!0}]])]),e("div",fe,[ge,u(e("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":l[6]||(l[6]=o=>t.value.price=o),placeholder:"請輸入售價"},null,512),[[v,t.value.price,void 0,{number:!0}]])])]),be,e("div",ye,[xe,u(e("textarea",{type:"text",class:"form-control",id:"description","onUpdate:modelValue":l[7]||(l[7]=o=>t.value.description=o),placeholder:"請輸入產品描述"},null,512),[[v,t.value.description]])]),e("div",$e,[ke,u(e("textarea",{type:"text",class:"form-control",id:"content","onUpdate:modelValue":l[8]||(l[8]=o=>t.value.content=o),placeholder:"請輸入產品說明內容"},null,512),[[v,t.value.content]])]),e("div",we,[e("div",Me,[u(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":l[9]||(l[9]=o=>t.value.is_enabled=o),"true-value":1,"false-value":0,id:"is_enabled"},null,512),[[S,t.value.is_enabled]]),Ue])])])])]),e("div",Ce,[Ve,e("button",{type:"button",class:"btn btn-primary",onClick:l[10]||(l[10]=o=>g.$emit("update-product",t.value))},"確認 ")])])])],512))}},De={class:"text-end"},Le={class:"table mt-4"},Ne=e("thead",null,[e("tr",null,[e("th",{width:"120"},"圖片"),e("th",{width:"120"},"分類"),e("th",null,"產品名稱"),e("th",{width:"120"},"原價"),e("th",{width:"120"},"售價"),e("th",{width:"100"},"是否啟用"),e("th",{width:"200"},"編輯")])],-1),Fe=["src"],je={class:"text-right"},Ae={class:"text-right"},Oe={key:0,class:"text-success"},Se={key:1,class:"text-danger"},Be={class:"btn-group"},Ie=["onClick"],Ee=["onClick"],Ke={__name:"Products",setup(P){const w=s([]),y=s({}),x=s(1),h=s([]),m=d=>{const c=`https://vue3-course-api.hexschool.io/api/cookiemidwang-api/admin/products/?page=${d}`;i.value=!0,k.get(c).then(a=>{i.value=!1,a.data.success&&(console.log(a.data),w.value=a.data.products,y.value=a.data.pagination,x.value=a.data.pagination.current_page,h.value=a.data.pagination.total_pages)})};F(()=>{m()});const f=s(null),t=s({}),_=s(!1),M=(d,c)=>{d===!1?(_.value=!1,t.value={...c}):(_.value=!0,t.value={}),f.value.showModal()},g=d=>{i.value=!0,t.value=d;let c="https://vue3-course-api.hexschool.io/api/cookiemidwang-api/admin/product";if(_.value===!0)console.log(_.value),k.post(c,{data:t.value}).then(a=>{a.data.success?(f.value.hideModal(),i.value=!1,m(),$.emit("push-message",{style:"success",title:"新增成功!"})):$.emit("push-message",{style:"danger",title:"新增失敗!",content:a.data.message.join("、")})});else{console.log(_.value);let a=`https://vue3-course-api.hexschool.io/api/cookiemidwang-api/admin/product/${d.id}`;k.put(a,{data:t.value}).then(n=>{n.data.success?(f.value.hideModal(),i.value=!1,m(),$.emit("push-message",{style:"success",title:"編輯成功!"})):$.emit("push-message",{style:"danger",title:"編輯失敗!",content:n.data.message.join("、")})})}},l=s();function o(d){t.value={...d},l.value.showModal()}const b=()=>{i.value=!0;const d=`https://vue3-course-api.hexschool.io/api/cookiemidwang-api/admin/product/${t.value.id}`;k.delete(d).then(c=>{c.data.success&&(l.value.hideModal(),i.value=!1,m(),$.emit("push-message",{style:"success",title:"刪除成功!"}))})},i=s(!1),$=I("emitter"),D=z();return(d,c)=>{const a=E("Loading");return r(),p(V,null,[U(a,{active:i.value},null,8,["active"]),e("div",De,[e("button",{class:"btn btn-primary",type:"button",onClick:c[0]||(c[0]=n=>M(!0))}," 新增商品 ")]),e("table",Le,[Ne,e("tbody",null,[(r(!0),p(V,null,j(w.value,n=>(r(),p("tr",{key:n.id},[e("td",null,[e("img",{src:n.imageUrl,alt:"",width:"120"},null,8,Fe)]),e("td",null,C(n.category),1),e("td",null,C(n.title),1),e("td",je,C(N(D).currency(n.origin_price)),1),e("td",Ae,C(N(D).currency(n.price)),1),e("td",null,[n.is_enabled?(r(),p("span",Oe,"啟用")):(r(),p("span",Se,"未啟用"))]),e("td",null,[e("div",Be,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:A=>M(!1,n)},"編輯",8,Ie),e("button",{class:"btn btn-outline-danger btn-sm",onClick:A=>o(n)},"刪除",8,Ee)])])]))),128))])]),U(Pe,{ref_key:"refModal",ref:f,product:t.value,onUpdateProduct:g},null,8,["product"]),U(J,{item:t.value,onDelItem:b,ref_key:"refDelModal",ref:l},null,8,["item"]),U(T,{pages:y.value,currentPage:x.value,pageLength:h.value,onEmitPages:m,onGoPrevious:m,onGoNext:m},null,8,["pages","currentPage","pageLength"])],64)}}};export{Ke as default};
