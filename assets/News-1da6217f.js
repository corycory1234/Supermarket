import{r as l,a as O,w as U,f as v,g as _,i as e,z as b,A as k,x as c,G as E,C as G,l as z,B as h,_ as R,F,y as q,j as D,E as V,v as I,s as H,t as J}from"./index-4594cac7.js";import{M as K}from"./modal-741f93e7.js";import{_ as Q}from"./DelModal-6438de47.js";import{_ as W}from"./Pagination-43b3de86.js";import{u as X}from"./filter-56047ace.js";import"./component-functions-91238543.js";const Y={class:"modal-dialog",role:"document"},Z={class:"modal-content"},ee=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},"Modal title"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),te={class:"modal-body"},oe={class:"mb-3"},ae=e("label",{for:"title"},"標題",-1),le={class:"mb-3"},se=e("label",{for:"customFile",class:"form-label"},[z("上傳圖片 "),e("i",{class:"fas fa-spinner fa-spin"})],-1),ne=["src"],ie={class:"mb-3"},ce=e("label",{for:"author"},"作者",-1),de={class:"mb-3"},ue=e("label",{for:"released_day"},"發行日",-1),re={class:"mb-3"},pe={class:"form-check"},me=e("label",{class:"form-check-label",for:"isPublic"},"是否刊登",-1),ve={class:"mb-3"},_e=e("label",{for:"content",class:"form-label"},"簡短描述",-1),he={class:"mb-3"},fe=e("label",{for:"content",class:"form-label"},"新聞內容",-1),be={class:"modal-footer"},ge=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1),we={__name:"NewsModal",props:{news:{type:Object}},emits:["update-news"],setup(f,{expose:x}){const g=f,d=l({}),p=l({});O(()=>{p.value=new K(d.value)}),x({showModal:()=>{p.value.show()},hideModal:()=>{p.value.hide()}});const t=l({}),u=l("");U(()=>g.news,()=>{t.value=g.news;const r=new Date(t.value.create_at*1e3).toISOString().split("T");[u.value]=r}),U(()=>u.value,r=>{t.value.create_at=Math.floor(new Date(r)/1e3)});const $=l();function C(){const r=l(new FormData);r.value.append("file-to-upload",$.value.files[0]);const a="https://vue3-course-api.hexschool.io/api/cookiemidwang-api/admin/upload";h.post(a,r.value).then(s=>{s.data.success&&(t.value.image=s.data.imageUrl)})}return(r,a)=>(v(),_("div",{class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"refOpenModal",ref:d},[e("div",Y,[e("div",Z,[ee,e("div",te,[e("div",oe,[ae,b(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":a[0]||(a[0]=s=>c(t).title=s),placeholder:"請輸入標題"},null,512),[[k,c(t).title]])]),e("div",le,[se,e("input",{type:"file",id:"customFile",class:"form-control",ref_key:"fileInput",ref:$,onChange:C},null,544)]),e("img",{class:"img-fluid",src:c(t).image,alt:""},null,8,ne),e("div",ie,[ce,b(e("input",{type:"text",class:"form-control",id:"author","onUpdate:modelValue":a[1]||(a[1]=s=>c(t).author=s),placeholder:"請輸入作者姓名"},null,512),[[k,c(t).author]])]),e("div",de,[ue,b(e("input",{type:"date",class:"form-control",id:"released_day","onUpdate:modelValue":a[2]||(a[2]=s=>E(u)?u.value=s:null)},null,512),[[k,c(u)]])]),e("div",re,[e("div",pe,[b(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":a[3]||(a[3]=s=>c(t).isPublic=s),"true-value":!0,"false-value":!1,id:"isPublic"},null,512),[[G,c(t).isPublic]]),me])]),e("div",ve,[_e,b(e("textarea",{type:"text",class:"form-control",id:"content","onUpdate:modelValue":a[4]||(a[4]=s=>c(t).description=s),placeholder:"請輸入簡短描述"},`\r
            `,512),[[k,c(t).description]])]),e("div",he,[fe,b(e("textarea",{type:"text",class:"form-control",id:"content","onUpdate:modelValue":a[5]||(a[5]=s=>c(t).content=s),placeholder:"請輸入新聞內容"},`\r
            `,512),[[k,c(t).content]])])]),e("div",be,[ge,e("button",{type:"button",class:"btn btn-primary",onClick:a[6]||(a[6]=s=>r.$emit("update-news",c(t)))},"更新文章 ")])])])],512))}};const $e=f=>(H("data-v-4d5bd94a"),f=f(),J(),f),ye={class:"text-end mt-4"},ke={class:"row justify-content-center change"},xe={class:"image"},Me=["src"],Ne=$e(()=>e("div",{class:"date"},[e("span",{class:"day"},"28"),e("span",{class:"month"},"Oct")],-1)),Ce={class:"btn-group"},De=["onClick"],Ve=["onClick"],Ie=["onClick"],Pe={key:0},Le={__name:"News",setup(f){O(()=>{d()});const x=l(null),g=l([]),d=n=>{N.value=N;const i=`https://vue3-course-api.hexschool.io/api/cookiemidwang-api/admin/articles?page=${n}`;h.get(i).then(o=>{console.log(o),x.value=o.data.articles,g.value=x.value.map(m=>m.id),M.value=o.data.pagination,N.value=M.value.current_page,L.value=M.value.total_pages,P(g)})},p=l([]),P=n=>{n.value.map(i=>{const o=`https://vue3-course-api.hexschool.io/api/cookiemidwang-api/admin/article/${i}`;h.get(o).then(m=>{p.value.unshift(m.data.article),console.log(p.value)})})},w=l(null),t=l({}),u=l(!1),$=(n,i)=>{n===!0?(u.value=!0,t.value={...i},console.log("我是打開編輯")):(u.value=!1,t.value={},t.value={create_at:new Date().getTime()/1e3},console.log("我是打開新增")),w.value.showModal()},C=n=>{t.value=n;const i="https://vue3-course-api.hexschool.io/api/cookiemidwang-api/admin/article";if(u.value===!1)h.post(i,{data:t.value}).then(o=>{console.log(o),w.value.hideModal(),d()});else{u.value=!0;let o=`https://vue3-course-api.hexschool.io/api/cookiemidwang-api/admin/article/${t.value.id}`;h.put(o,{data:t.value}).then(m=>{console.log(m),w.value.hideModal(),d()})}},r=n=>{t.value={...n},a.value.showModal()},a=l(null),s=()=>{const n=`https://vue3-course-api.hexschool.io/api/cookiemidwang-api/admin/article/${t.value.id}`;h.delete(n).then(i=>{console.log(i),a.value.hideModal(),d()})},A=l(""),y=l(!1),T=n=>{const i=`https://vue3-course-api.hexschool.io/api/cookiemidwang-api/admin/article/${n.id}`;h.get(i).then(o=>{console.log(o),A.value=o.data.article.content}),y.value=!0},B=()=>{y.value=!1},M=l([]),N=l(1),L=l([]),j=X();return(n,i)=>(v(),_(F,null,[e("div",ye,[e("button",{class:"btn btn-primary",onClick:i[0]||(i[0]=o=>$(!1))}," 建立新聞 ")]),e("div",ke,[(v(!0),_(F,null,q(p.value,(o,m)=>(v(),_("div",{class:"snip1493 col-3",key:m},[e("div",xe,[e("img",{src:o?o.image:null,alt:""},null,8,Me)]),e("figcaption",null,[Ne,e("h4",null,V(o?o.title:null),1),e("h5",null,V(c(j).date(o?o.create_at:null)),1),e("footer",null,[e("div",Ce,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:S=>$(!0,o)},"編輯",8,De),e("button",{class:"btn btn-outline-danger btn-sm",onClick:S=>r(o)},"刪除",8,Ve),y.value===!1?(v(),_("button",{key:0,class:"btn btn-outline-info btn-sm",onClick:S=>T(o)},"新聞內容",8,Ie)):I("",!0),y.value===!0?(v(),_("button",{key:1,class:"btn btn-outline-info btn-sm",onClick:B},"收回")):I("",!0)])]),y.value===!0?(v(),_("p",Pe,V(o?o.content:null),1)):I("",!0)])]))),128))]),D(we,{ref_key:"refNewsModal",ref:w,news:t.value,onUpdateNews:C},null,8,["news"]),D(W,{pages:M.value,currentPage:N.value,pageLength:L.value,onGoPrevious:d,onGoNext:d,onEmitPages:d},null,8,["pages","currentPage","pageLength"]),D(Q,{ref_key:"refDelModal",ref:a,item:t.value,onDelItem:s},null,8,["item"])],64))}},Be=R(Le,[["__scopeId","data-v-4d5bd94a"]]);export{Be as default};
