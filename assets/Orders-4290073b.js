import{r as n,a as L,w as P,f as s,g as o,i as t,E as l,v as C,x as $,F as g,y as O,B as w,D as j,e as F,j as x,H as U,z as q,C as z}from"./index-ed73d2f1.js";import{M as H}from"./modal-e1e3e991.js";import{u as S}from"./filter-d711ac0f.js";import{_ as I}from"./DelModal-3afb7e86.js";import{_ as A}from"./Pagination-b22af152.js";import"./component-functions-17ff5a6f.js";const G={class:"modal-dialog modal-xl",role:"document"},J={class:"modal-content border-0"},K=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Q={class:"modal-body"},R={class:"row"},T={class:"col-md-4"},W=t("h3",null,"用戶資料",-1),X={class:"table"},Y={key:0},Z=t("th",{style:{width:"100px"}},"姓名",-1),tt=t("th",null,"Email",-1),et=t("th",null,"電話",-1),lt=t("th",null,"地址",-1),st={class:"col-md-8"},ot=t("h3",null,"訂單細節",-1),at={class:"table"},nt=t("th",{style:{width:"100px"}},"訂單編號",-1),dt=t("th",null,"下單時間",-1),it=t("th",null,"付款時間",-1),ut={key:0},rt={key:1},ct=t("th",null,"付款狀態",-1),_t={key:0,class:"text-success"},ht={key:1,class:"text-muted"},pt=t("th",null,"總金額",-1),vt=t("h3",null,"選購商品",-1),mt={class:"table"},bt=t("thead",null,[t("tr")],-1),ft={class:"text-end"},yt={class:"modal-footer"},$t=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1),gt={__name:"OrderModal",props:{order:{type:Object,default(){return{}}}},emits:["update-product"],setup(D,{expose:i}){const h=D,p=n({}),v=n({});L(()=>{v.value=new H(p.value)}),i({showModal:()=>{v.value.show()},hideModal:()=>{v.value.hide()}}),n(null),n(null);const e=n({}),M=n(!1);P(()=>{h.order},()=>{e.value=h.order,M.value=e.value.is_paid});const _=S();return(k,y)=>(s(),o("div",{class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"refOpenModal",ref:p},[t("div",G,[t("div",J,[K,t("div",Q,[t("div",R,[t("div",T,[W,t("table",X,[e.value.user?(s(),o("tbody",Y,[t("tr",null,[Z,t("td",null,l(e.value.user.name),1)]),t("tr",null,[tt,t("td",null,l(e.value.user.email),1)]),t("tr",null,[et,t("td",null,l(e.value.user.tel),1)]),t("tr",null,[lt,t("td",null,l(e.value.user.address),1)])])):C("",!0)])]),t("div",st,[ot,t("table",at,[t("tbody",null,[t("tr",null,[nt,t("td",null,l(e.value.id),1)]),t("tr",null,[dt,t("td",null,l($(_).date(e.value.create_at)),1)]),t("tr",null,[it,t("td",null,[e.value.paid_date?(s(),o("span",ut,l($(_).date(e.value.paid_date)),1)):(s(),o("span",rt,"時間不正確"))])]),t("tr",null,[ct,t("td",null,[e.value.is_paid?(s(),o("strong",_t,"已付款")):(s(),o("span",ht,"尚未付款"))])]),t("tr",null,[pt,t("td",null,l($(_).currency(e.value.total)),1)])])]),vt,t("table",mt,[bt,t("tbody",null,[(s(!0),o(g,null,O(e.value.products,u=>(s(),o("tr",{key:u.id},[t("th",null,l(u.product.title),1),t("td",null,l(u.qty)+" / "+l(u.product.unit),1),t("td",ft,l($(_).currency(u.final_total)),1)]))),128))])])])])]),t("div",yt,[$t,t("button",{type:"button",class:"btn btn-primary",onClick:y[0]||(y[0]=u=>k.$emit("update-order",e.value))},"確認")])])])],512))}},kt={class:"table mt-4"},xt=t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),Mt=["textContent"],wt={class:"list-unstyled"},Ct={class:"text-right"},Ot={class:"form-check form-switch"},Dt=["id","onUpdate:modelValue","onChange"],Lt=["for"],St={key:0},Et={key:1},Vt={class:"btn-group"},Bt=["onClick"],Nt=["onClick"],Ht={__name:"Orders",setup(D){const i=n(!1);L(()=>{b(),console.log("https://vue3-course-api.hexschool.io/")});const h=n(1),p=n({}),v=n({}),b=(d=1)=>{h.value=d;const r=`https://vue3-course-api.hexschool.io/api/cookiemidwang-api/admin/orders?page=:${d}`;i.value=!0,w.get(r).then(m=>{p.value=m.data.orders,v.value=m.data.pagination,i.value=!1,console.log(m)})},f=n({}),e=n(),M=(d,r)=>{f.value={...r},e.showModal()},_=n({is_paid:null}),k=d=>{i.value=!0;const r=`https://vue3-course-api.hexschool.io/api/cookiemidwang-api/admin/order/${d.id}`;_.value.is_paid=d.is_paid,w.put(r,{data:_.value}).then(m=>{i.value=!1,b(h.value),E.emit("push-message",{style:"success",title:"更新付款狀態!"})})},y=n(),u=()=>{const d=`https://vue3-course-api.hexschool.io/api/cookiemidwang-api/admin/order/${f.value.id}`;i.value=!0,w.delete(d).then(r=>{console.log(r),y.value.hideModal(),i.value=!1,b(h.value)})},E=j("emitter"),V=S();return(d,r)=>{const m=F("Loading");return s(),o(g,null,[x(m,{active:i.value},null,8,["active"]),t("table",kt,[xt,t("tbody",null,[(s(!0),o(g,null,O(p.value,(a,B)=>(s(),o(g,{key:B},[p.value.length?(s(),o("tr",{key:0,class:U({"text-secondary":!a.is_paid})},[t("td",null,l($(V).date(a.create_at)),1),t("td",null,[a.user?(s(),o("span",{key:0,textContent:l(a.user.email)},null,8,Mt)):C("",!0)]),t("td",null,[t("ul",wt,[(s(!0),o(g,null,O(a.products,(c,N)=>(s(),o("li",{key:N},l(c.product.title)+" 數量："+l(c.qty)+" "+l(c.product.unit),1))),128))])]),t("td",Ct,l(a.total),1),t("td",null,[t("div",Ot,[q(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${a.id}`,"onUpdate:modelValue":c=>a.is_paid=c,onChange:c=>k(a)},null,40,Dt),[[z,a.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${a.id}`},[a.is_paid?(s(),o("span",St,"已付款")):(s(),o("span",Et,"未付款"))],8,Lt)])]),t("td",null,[t("div",Vt,[t("button",{class:"btn btn-outline-primary btn-sm",onClick:c=>M(!1,a)},"檢視",8,Bt),t("button",{class:"btn btn-outline-danger btn-sm",onClick:c=>d.openDelOrderModal(a)},"刪除",8,Nt)])])],2)):C("",!0)],64))),128))])]),x(gt,{order:f.value,ref_key:"refOrderModal",ref:e,onUpdatePaid:k},null,8,["order"]),x(I,{item:f.value,ref_key:"refDelModal",ref:y,onDelItem:u},null,8,["item"]),x(A,{pages:v.value,onEmitPages:b},null,8,["pages"])],64)}}};export{Ht as default};
