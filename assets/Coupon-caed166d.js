import{r as u,a as U,w as D,f as v,g as h,i as e,z as f,A as g,x as d,G as S,C as B,p as T,e as j,j as C,F as L,y as F,B as $,E as k}from"./index-eb4185d7.js";import{M as N}from"./modal-f2b0cdf5.js";import{_ as E}from"./DelModal-edb1a33e.js";import{e as I,_ as z}from"./ToastMessages-5c2419a2.js";import{u as G}from"./filter-2e5f3b44.js";import"./component-functions-80165422.js";const R={class:"modal-dialog",role:"document"},q={class:"modal-content"},H=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},"Modal title"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),J={class:"modal-body"},K={class:"mb-3"},P=e("label",{for:"title"},"標題",-1),Q={class:"mb-3"},W=e("label",{for:"coupon_code"},"優惠碼",-1),X={class:"mb-3"},Y=e("label",{for:"due_date"},"到期日",-1),Z={class:"mb-3"},ee=e("label",{for:"price"},"折扣百分比",-1),oe={class:"mb-3"},te={class:"form-check"},le=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),se={class:"modal-footer"},ae=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1),ne={__name:"CouponModal",props:{coupon:Object},emits:["update-coupon"],setup(x,{expose:t}){const _=x,p=u({}),c=u({});U(()=>{c.value=new N(p.value)}),t({showModal:()=>{c.value.show()},hideModal:()=>{c.value.hide()}});const l=u({}),i=u("");return D(()=>_.coupon,()=>{l.value=_.coupon;const r=new Date(l.value.due_date*1e3).toISOString().split("T");[i.value]=r}),D(()=>i.value,r=>{l.value.due_date=Math.floor(new Date(r)/1e3)}),(r,o)=>(v(),h("div",{class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"refOpenModal",ref:p},[e("div",R,[e("div",q,[H,e("div",J,[e("div",K,[P,f(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":o[0]||(o[0]=a=>d(l).title=a),placeholder:"請輸入標題"},null,512),[[g,d(l).title]])]),e("div",Q,[W,f(e("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":o[1]||(o[1]=a=>d(l).code=a),placeholder:"請輸入優惠碼"},null,512),[[g,d(l).code]])]),e("div",X,[Y,f(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":o[2]||(o[2]=a=>S(i)?i.value=a:null)},null,512),[[g,d(i)]])]),e("div",Z,[ee,f(e("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":o[3]||(o[3]=a=>d(l).percent=a),placeholder:"請輸入折扣百分比",max:"100"},null,512),[[g,d(l).percent,void 0,{number:!0}]])]),e("div",oe,[e("div",te,[f(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=a=>d(l).is_enabled=a),id:"is_enabled"},null,512),[[B,d(l).is_enabled]]),le])])]),e("div",se,[ae,e("button",{type:"button",class:"btn btn-primary",onClick:o[5]||(o[5]=a=>r.$emit("update-coupon",d(l)))},"更新優惠券 ")])])])],512))}},de={class:"container-fluid mt-3 position-relative"},ie={class:"text-end mt-4"},ue={class:"table mt-4"},ce=e("thead",null,[e("tr",null,[e("th",null,"名稱"),e("th",null,"折扣百分比"),e("th",null,"到期日"),e("th",null,"是否啟用"),e("th",null,"編輯")])],-1),pe={key:0,class:"text-success"},re={key:1,class:"text-muted"},me={class:"btn-group"},_e=["onClick"],ve=["onClick"],$e={__name:"Coupon",props:{config:Object},setup(x){const t=u({title:"",is_enabled:0,percent:100,code:""}),_=u(!1),p=u(!1),c=u(null),y=(n,s)=>{n===!1?(_.value=!1,t.value={...s},console.log(t.value)):(_.value=!0,t.value={},t.value={due_date:new Date().getTime()/1e3},console.log(t.value)),c.value.showModal()},w=n=>{t.value={...n},o.value.showModal()},l=u({}),i=()=>{p.value=!0;const n="https://vue3-course-api.hexschool.io/api/cookiemidwang-api/admin/coupons";$.get(n,t.value).then(s=>{console.log(s),l.value=s.data.coupons,p.value=!1})};U(()=>{i()});const r=n=>{if(_.value===!0){const s="https://vue3-course-api.hexschool.io/api/cookiemidwang-api/admin/coupon";$.post(s,{data:n}).then(b=>{console.log(b,n),M.emit("push-message",{style:"success",title:"新增優惠券成功!"}),i(),c.value.hideModal()})}else{const s=`https://vue3-course-api.hexschool.io/api/cookiemidwang-api/admin/coupon/${t.value.id}`;$.put(s,{data:t.value}).then(b=>{console.log(b),M.emit("push-message",{style:"success",title:"編輯優惠券成功!"}),i(),c.value.hideModal()})}},o=u(null),a=()=>{const n=`https://vue3-course-api.hexschool.io/api/cookiemidwang-api/admin/coupon/${t.value.id}`;p.value=!0,$.delete(n).then(s=>{console.log(s,t.value),M.emit("push-message",{style:"success",title:"刪除優惠券成功!"}),o.value.hideModal(),i()})},M=I;T("emitter",M);const V=G();return(n,s)=>{const b=j("Loading");return v(),h(L,null,[e("div",de,[C(z)]),e("div",null,[C(b,{active:p.value},null,8,["active"]),e("div",ie,[e("button",{class:"btn btn-primary",onClick:s[0]||(s[0]=m=>y(!0))}," 建立新的優惠券 ")]),e("table",ue,[ce,e("tbody",null,[(v(!0),h(L,null,F(l.value,(m,A)=>(v(),h("tr",{key:A},[e("td",null,k(m.title),1),e("td",null,k(m.percent)+"%",1),e("td",null,k(d(V).date(m.due_date)),1),e("td",null,[m.is_enabled===1?(v(),h("span",pe,"啟用")):(v(),h("span",re,"未啟用"))]),e("td",null,[e("div",me,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:O=>y(!1,m)},"編輯",8,_e),e("button",{class:"btn btn-outline-danger btn-sm",onClick:O=>w(m)},"刪除",8,ve)])])]))),128))])]),C(ne,{coupon:t.value,ref_key:"refCouponModal",ref:c,onUpdateCoupon:r},null,8,["coupon"]),C(E,{item:t.value,ref_key:"refDelModal",ref:o,onDelItem:a},null,8,["item"])])],64)}}};export{$e as default};
